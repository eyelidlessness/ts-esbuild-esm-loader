#!/usr/bin/env bash

NODE_VERSION=$(node --version)
NODE_MAJOR_VERSION="${NODE_VERSION:0:4}"
LOADER_OPTIONS=''
LOADER='./dist/index.mjs'

if [ $NODE_MAJOR_VERSION == "v12." ]
then
  LOADER_OPTIONS="--experimental-modules --experimental-loader=$LOADER"
elif [ $NODE_MAJOR_VERSION == "v14." ]
then
  LOADER_OPTIONS="--experimental-loader=$LOADER"
else
  echo "Unexpected Node version: $NODE_MAJOR_VERSION"
  exit 1
fi

export NODE_OPTIONS="$NODE_OPTIONS $LOADER_OPTIONS"

yarn run $@
